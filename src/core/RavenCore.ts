import { MemoryManager } from '../memory/MemoryManager'; import { ApiRouter } from '../apis/ApiRouter'; import { PersonalityFilter } from './PersonalityFilter'; import { EmotionEngine } from './EmotionEngine'; import { TimingEngine } from './TimingEngine'; export class RavenCore { private memory; private apiRouter; private personalityFilter; private emotionEngine; private timingEngine; constructor(memory) {this.memory = memory; this.apiRouter = new ApiRouter(); this.personalityFilter = new PersonalityFilter(); this.emotionEngine = new EmotionEngine(); this.timingEngine = new TimingEngine();} async handleUserInput(userMessage) {const chatHistory = await this.memory.read('chat_history.json'); const emotionalState = await this.memory.read('emotional_state.json'); const currentMood = this.emotionEngine.getMood(emotionalState); const apiChoice = this.apiRouter.decideApi(userMessage, chatHistory); const apiResponse = await this.apiRouter.callApi(apiChoice, userMessage, chatHistory); const emotionalResponse = this.personalityFilter.filter(apiResponse, currentMood); const timedResponse = this.timingEngine.addTiming(emotionalResponse); await this.memory.append('chat_history.json', {timestamp: new Date().toISOString(), user: userMessage, raven: timedResponse, mood: currentMood}); return timedResponse;}}